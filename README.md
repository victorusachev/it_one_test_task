# Тестовое задание от компании IT_ONE

Текст тестового задания см. в TASK.md, файл лога - data/maillog.txt.

## Конфигурация

Конфигурация осуществляется через переменные окружения, которые могут быть переопределены через файл `.env`.
Пример конфигурационного файла с переменными окружения - `.env.example`.
Путь к файлу `.env` может быть переопределён через переменную окружения `ENV`.


## Запуск

    python -m it_one_test_task


## Примечания
Здесь описаны обнаруженные противоречия и принятые допущения.

1. В задании 1 предполагается наполнение таблицы `message` данными из строк о прибытии сообщения.
В описании таблицы указано, что "в этом случае за флагом следует адрес отправителя", но нет указаний, как получить адрес получателя, который нужен для задания 2.
Пример лога не позволяет сделать выводы для корректной разметки.
2. Задание 2 предполагает поиск по адресу получателя в обеих таблицах.
Но таблица `message` не имеет отдельного поля для адреса получателя. Принято решение фильтровать записи на основании вхождения искомого адреса в строку лога - в поле `str`.
3. В примере лога встречаются записи вида `2012-02-13 14:39:22 1RwtJa-000AFJ-3B <= <> R=1RookS-000Pg8-VO U=mailnull P=local S=3958`.
Я выяснил, что комбинация `<= <>` - это "прибытие сообщения" с адресом отправителя `<>`, что означает рикошет. Нужно ли рассматривать такое сообщение в задании 1, не ясно.
При этом такие сообщения не соответствуют заданной структуре таблицы `message`, т.к. не имеют обязательного `id`. Решено игнорировать такие записи и логировать факт пропуска.
4. В примере лога встречаются записи, не имеющие `int_id`, который является обязательным для обеих таблиц.  Решено игнорировать такие записи и логировать факт пропуска.
5. Индексы. В контексте задания 2 имеет смысл добавить для таблицы `log` составной индекс (`address`, `int_id`, `created`) - по `address` ведётся поиск, а по остальным - сортировка.
А как быть с таблицей `message` - не ясно: начинать нужно с колонки, содержащей адрес получателя, но в задании нет информации, где искать адрес получателя.
6. В описании таблицы `message` присутствует поле `status`, но нет указаний насчёт поля.
7. Таблица `log` не имеет первичного ключа. В решении используется SQLAlchemy ORM, которой необходим PK, поэтому добавлен составной PK: (created, int_id, address, str).
